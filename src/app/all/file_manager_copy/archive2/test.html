<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, minimal-ui" />
        
        <title>File Editor</title>
        
        <script src="/js/greyspots.js" type="text/javascript"></script>
        <link href="/css/greyspots.css" type="text/css" rel="stylesheet" />
        
        <script src="editor-ace.js" type="text/javascript"></script>
        <link href="editor-ace.css" type="text/css" rel="stylesheet" />
        
        <script src="editor-element.js" type="text/javascript"></script>
        <link href="editor-element.css" type="text/css" rel="stylesheet" />
        
        <script src="editor-panel.js" type="text/javascript"></script>
        <link href="editor-panel.css" type="text/css" rel="stylesheet" />
        
        <script>
// //global GS, console, doT, window, encodeHTML, evt, setTimeout, clearTimeout, ml
// //jslint browser, maxlen:80

// // # CODE INDEX:             <- (use "find" (CTRL-f/CMD-f) to skip to a section)
// //      # TOP                <- (this just brings you back this index)
// //      # GLOBAL VARIABLES
// //      # RENDER FUNCTIONS
// //      # CODE SENSE FUNCTIONS
// //      # FILE SPLIT FUNCTIONS
// //      # EVENT FUNCTIONS
// //          # QUERYSTRING EVENTS
// //          # CHANGE EVENTS
// //          # KEY EVENTS
// //          # TOGGLE EVENTS
// //          # RESIZE EVENTS
// //          # AUTOCOMPLETE EVENTS
// //          # HIGH LEVEL BINDING
// //      # STARTER FUNCTIONS
// //      # PAGE LOAD
// //
// // For code that needs to be completed:
// //      # NEED CODING

// (function () {
// // #############################################################################
// // ############################# GLOBAL VARIABLES ##############################
// // #############################################################################
//     "use strict";

//     // the parameters of this page come from the query string. This is the central
//     //      location for the query string to exist.
//     var QS;

//     // these are the central locations for the final text and change stamp.
//     var strFile;
//     var strChangeStamp;

//     var elems = {};

// // #############################################################################
// // ############################# RENDER FUNCTIONS ##############################
// // #############################################################################


// // #############################################################################
// // ########################### CODE SENSE FUNCTIONS ############################
// // #############################################################################


// // #############################################################################
// // ########################### FILE SPLIT FUNCTIONS ############################
// // #############################################################################


// // #############################################################################
// // ############################## EVENT FUNCTIONS ##############################
// // #############################################################################

//     // ############### QUERYSTRING EVENTS ###############
//     function bindQuerystring() {
        
//     }

//     // ############### CHANGE EVENTS ###############
//     function bindChange() {
        
//     }

//     // ############### KEY EVENTS ###############
//     function bindKey() {
        
//     }

//     // ############### TOGGLE EVENTS ###############
//     function bindToggle() {
        
//     }

//     // ############### RESIZE EVENTS ###############
//     function bindResize() {
        
//     }

//     // ############### AUTOCOMPLETE EVENTS ###############
//     function bindAutocomplete() {
        
//     }

//     // ############### HIGH LEVEL BINDING ###############
//     function bindEditor() {
//         bindQuerystring();
//         bindChange();
//         bindKey();
//         bindToggle();
//         bindResize();
//         bindAutocomplete();
//     }


// // #############################################################################
// // ############################# STARTER FUNCTIONS #############################
// // #############################################################################

//     // get minimum DOM ready
//     function prepareElements() {
//         elems.root = document.getElementById('editor-container');

//         elems.root.innerHTML = ml(function () {/*
        
//         */
//         });
//     }

//     // we load our files with websockets. Let's do that here.
//     function loadFile() {
//         // we always want a fresh copy of the querystring
//         QS = GS.qryToJSON(GS.getQueryString());

//         // we can't go forward without a link
//         if (!QS.link) {
//             var templateElement = document.createElement('template');

//             templateElement.innerHTML = ml(function () {/*
//                 <gs-page>
//                     <gs-header><center><h3>Error</h3></center></gs-header>
//                     <gs-body padded>
//                         <br /><br />
//                         <center><b>No file link provided.</b></center>
//                         <br /><br />
//                     </gs-body>
//                 </gs-page>*/
//             });

//             GS.openDialog(templateElement);
//             return false;
//         }

//         // we want the user to be able to differentiate editing tabs
//         document.title = (
//             'Edit: ' + QS.link.substring(QS.link.lastIndexOf('/') + 1)
//         );

//         // we want the user to see the full link without having to decypher the
//         //      querystring themselves.
//         document.getElementById('display-full-link').innerHTML = QS.link;

//         // get the file
//         GS.addLoader('file-load', 'Loading File...');
//         GS.requestFromSocket(
//             GS.envSocket,
//             'FILE\tREAD\t' + GS.encodeForTabDelimited(QS.link),
//             function (data, error, errorData) {
//                 var index;

//                 if (!error) {
//                     if (data !== 'TRANSACTION COMPLETED') {
//                         // the first line of the response is the change stamp
//                         index = data.indexOf('\n');
//                         strChangeStamp = data.substring(0, index);
//                         strFile = data.substring(index + 1);
//                     } else {
//                         GS.removeLoader('file-load');
//                     }
//                 } else {
//                     GS.removeLoader('file-load');
//                     GS.webSocketErrorDialog(errorData);
//                 }
//             }
//         );
//     }

//     // start editor fresh. Our editor is complex, particularly when dealing with
//     //      HTML files. HTML files are broken down into multiple ace instances.
//     //      One for each script tag, style tag, external file, head tag, body
//     //      tag, and one for the whole file. All other file types only have an
//     //      editor for the whole file. The ace instances that have code from the
//     //      main file will update a central variable and then we'll resplit the
//     //      file between the aces. This is to make sure that everything stays up
//     //      to date. This update and resplit process will take place on every
//     //      keypress.
//     function startEditor() {
//         prepareElements();
//         loadFile();
//         bindEditor();
//     }

// // #############################################################################
// // ################################# PAGE LOAD #################################
// // #############################################################################

//     // page load is complete, time to begin setting up the editor
//     window.addEventListener('load', function () {
//         startEditor();
//     });
// }());

//global GS, window, document
//jslint browser
window.addEventListener('password-error', function (event) {
    "use strict";
    var str_keyVariable = event.keyVariable;

    GS.openDialog(event.reason + '-password-dialog', '', function () {
        window[str_keyVariable] = document.getElementById('dialog-password-control').value;

        GS.triggerEvent(
            window,
            'try-password',
            {keyVariable: str_keyVariable}
        );
    });
});

function test() {
    var templateElement = document.createElement('template');

    templateElement.setAttribute('data-mode', 'constrained');
    templateElement.innerHTML = ml(function () {/*
        <gs-page>
            <gs-header>
                <center><h3></h3></center>
            </gs-header>
            <gs-body>
                <gs-ace id="test" mode="javascript" theme="tomorrow_night"></gs-ace>
            </gs-body>
            <gs-footer></gs-footer>
        </gs-page>*/
    });

    GS.openDialog(templateElement, function () {
        document.getElementById('test').value = 'asdfasdf';
    });
}
        </script>
        <style>
        </style>
    </head>
    <body>
<template id="no-password-dialog">
    <gs-page>
        <gs-header><center><h3>Enter Password</h3></center></gs-header>
        <gs-body padded>
            Please enter the password:
            <gs-text type="password" id="dialog-password-control" autofocus></gs-text>
        </gs-body>
        <gs-footer>
            <gs-button dialogclose bg-primary listen-for-return>Ok</gs-button>
        </gs-footer>
    </gs-page>
</template>
<template id="bad-password-dialog">
    <gs-page>
        <gs-header><center><h3>Bad Password</h3></center></gs-header>
        <gs-body padded>
            Please re-enter the password:
            <gs-text type="password" id="dialog-password-control" autofocus></gs-text>
        </gs-body>
        <gs-footer>
            <gs-button dialogclose bg-primary listen-for-return>Ok</gs-button>
        </gs-footer>
    </gs-page>
</template>
        <!--<gs-page>
            <gs-header>
                <b id="display-full-link">File Editor</b>
            </gs-header>
            <gs-body id="editor-container">
            </gs-body>
        </gs-page>-->
        <gs-window>
            <gs-pane style="width: 20em;">
                <gs-page>
                    <gs-header><b>Static</b></gs-header>
                    <gs-body>
                        <gs-bace value="test" mode="javascript" theme="tomorrow_night" onchange="console.log('change:', this.value);" onvalue_change="console.log('test:', this.value);"></gs-bace>
                    </gs-body>
                </gs-page>
            </gs-pane>
            <gs-pane style="min-width: 50px;">
                <gs-page>
                    <gs-header><b>Stretchy</b></gs-header>
                    <gs-body>
                        <gs-bace encrypted="asdf" mode="css" value="U2FsdGVkX19uWuZRK15+yn05taoNI4e+Lq9+ymAaBwI=" theme="tomorrow_night" onvalue_change="console.log('test:', this.value);"></gs-bace>
                        <!--<gs-ace value="test" onchange="console.log('test');"></gs-ace>-->
                    </gs-body>
                </gs-page>
            </gs-pane>
            <gs-pane style="min-width: 50px;">
                <gs-page>
                    <gs-header><b>Stretchy</b></gs-header>
                    <gs-body>
                        <gs-bace value="test" disabled onvalue_change="console.log('test:', this.value);"></gs-bace>
                    </gs-body>
                </gs-page>
            </gs-pane>
            <gs-pane style="min-width: 50px;">
                <gs-page>
                    <gs-header><b>Stretchy</b></gs-header>
                    <gs-body>
                        <gs-bace value="test" readonly onchange="console.log('test');"></gs-bace>
                    </gs-body>
                </gs-page>
            </gs-pane>
        </gs-window>
    </body>
</html>